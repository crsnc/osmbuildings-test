<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Otel 3D Harita</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- OSMBuildings -->
<script src="https://cdn.osmbuildings.org/4.0.0/OSMBuildings.js"></script>

<style>
  html, body { height: 100%; margin: 0; }
  #map { width: 100%; height: 100%; }

  /* Panel */
  .panel{
    position: fixed; left: 50%; bottom: 12px;
    transform: translateX(-50%);
    width:min(780px,96vw); z-index:1000;
    background:#fff; border-radius:14px; box-shadow:0 8px 24px rgba(0,0,0,.16); padding:12px;
    display:flex; flex-direction:column; gap:8px;
  }
  .row{display:flex; align-items:center; gap:8px; flex-wrap:wrap;}
  input[type="search"]{flex:1; padding:10px; border-radius:10px; border:1px solid #e5e7eb;}
  button, select{padding:10px; border-radius:10px; border:1px solid #e5e7eb; cursor:pointer;}
  .results{position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #e5e7eb; max-height:36vh; overflow:auto; border-radius:10px; display:none; z-index:1001;}
  .results .item{padding:8px 12px; cursor:pointer;}
  .results .item:hover{background:#f1f5f9;}
</style>
</head>
<body>

<div id="map"></div>

<div class="panel">
  <div class="row">
    <input id="q" type="search" placeholder="Ara: restoran, spa, havuzâ€¦">
    <button id="go" disabled>Git</button>
    <select id="lang">
      <option value="tr" selected>TR</option>
      <option value="en">EN</option>
    </select>
  </div>
  <div class="row">
    <button id="pick">Haritadan Hedef</button>
    <button id="follow">ðŸŽ¯ Ä°zle: KapalÄ±</button>
    <button id="toggle3d">3D AÃ§</button>
    <label><input type="checkbox" id="tglIndoor" checked> Indoor</label>
    <label><input type="checkbox" id="tglOutdoor" checked> Outdoor</label>
    <button id="reset">SÄ±fÄ±rla</button>
  </div>
  <div id="results" class="results"></div>
</div>

<script>
// ===== Harita ve OSMBuildings =====
var map = L.map('map').setView([36.6002, 31.8046], 16);

var baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap contributors'
}).addTo(map);

var osmb = new OSMBuildings({
    container: map.getContainer(),
    position: { latitude: 36.6002, longitude: 31.8046 },
    zoom: 16
});
osmb.addMapTiles('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

// ===== Indoor/Outdoor Layers =====
var indoorLayer = L.layerGroup().addTo(map);
var outdoorLayer = L.layerGroup().addTo(map);

// Ã–rnek markerlar (GeoJSON ile deÄŸiÅŸtirilebilir)
var indoorData = [
  {name:"Resepsiyon", coords:[36.6005, 31.8048]},
  {name:"Spa", coords:[36.6003, 31.8052]}
];
var outdoorData = [
  {name:"Havuz", coords:[36.5999, 31.8040]},
  {name:"Restoran", coords:[36.6000, 31.8055]}
];

indoorData.forEach(f=>{
  var m=L.marker(f.coords).bindPopup(f.name);
  indoorLayer.addLayer(m);
});
outdoorData.forEach(f=>{
  var m=L.marker(f.coords).bindPopup(f.name);
  outdoorLayer.addLayer(m);
});

// Toggle
document.getElementById('tglIndoor').addEventListener('change', e=>{
  if(e.target.checked) map.addLayer(indoorLayer); else map.removeLayer(indoorLayer);
});
document.getElementById('tglOutdoor').addEventListener('change', e=>{
  if(e.target.checked) map.addLayer(outdoorLayer); else map.removeLayer(outdoorLayer);
});

// ===== Konum takibi =====
var userMarker = L.circleMarker([36.6002, 31.8046], {radius:6,color:'#1d4ed8',fillColor:'#1d4ed8',fillOpacity:0.8});
userMarker.addTo(map);

var followState=false;
document.getElementById('follow').onclick=()=>{
  followState=!followState;
  document.getElementById('follow').textContent = followState?'ðŸŽ¯ Ä°zle: AÃ§Ä±k':'ðŸŽ¯ Ä°zle: KapalÄ±';
  if(followState && navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      userMarker.setLatLng([pos.coords.latitude,pos.coords.longitude]);
      map.setView([pos.coords.latitude,pos.coords.longitude], map.getZoom());
    });
  }
};

// ===== 3D toggle =====
var toggle3dBtn = document.getElementById("toggle3d");
var osmbEnabled=false;
toggle3dBtn.onclick = () => {
  osmbEnabled = !osmbEnabled;
  toggle3dBtn.textContent = osmbEnabled ? "3D Kapat" : "3D AÃ§";
  // OSMBuildings container zaten map ile aynÄ±, sadece gÃ¶rÃ¼nÃ¼rlÃ¼k kontrolÃ¼
  map.getContainer().style.zIndex = osmbEnabled ? 0 : 1;
  osmb.render();
};

// ===== Hedef seÃ§imi =====
var destMarker=null;
var pickMode=false;
document.getElementById('pick').onclick=()=>{
  pickMode=!pickMode;
  document.getElementById('pick').classList.toggle('active',pickMode);
};
map.on('click', e=>{
  if(pickMode){
    if(destMarker) map.removeLayer(destMarker);
    destMarker=L.marker(e.latlng,{icon:L.icon({iconUrl:'https://cdn-icons-png.flaticon.com/512/684/684908.png',iconSize:[32,32]})}).addTo(map);
    pickMode=false;
    document.getElementById('pick').classList.remove('active');
  }
});

// ===== Arama =====
const resultsEl=document.getElementById('results');
const searchInput=document.getElementById('q');
searchInput.addEventListener('input', ()=>{
  const q = searchInput.value.toLowerCase();
  if(!q){ resultsEl.style.display='none'; return; }

  const matches=[];
  indoorData.forEach(f=>{ if(f.name.toLowerCase().includes(q)) matches.push({name:f.name, coords:f.coords}); });
  outdoorData.forEach(f=>{ if(f.name.toLowerCase().includes(q)) matches.push({name:f.name, coords:f.coords}); });

  resultsEl.innerHTML='';
  matches.forEach(m=>{
    const div = document.createElement('div');
    div.className='item';
    div.textContent = m.name;
    div.onclick=()=>{ map.setView(m.coords,17); resultsEl.style.display='none'; };
    resultsEl.appendChild(div);
  });
  resultsEl.style.display=matches.length>0?'block':'none';
});

// ===== Reset =====
document.getElementById('reset').onclick=()=>{
  searchInput.value='';
  resultsEl.style.display='none';
  if(destMarker) map.removeLayer(destMarker); destMarker=null;
};
</script>
</body>
</html>
